<!-- Generate the report -->
<script>
var drugs=<%= raw @drugs.pluck(:id, :name) %>;
var symptoms=<%= raw @symptoms.pluck(:id, :name) %>;
var side_effects = <%= raw @side_effects.pluck(:id, :drug_id, :symptom_id) %>

function generate_report() {
  var drug_list = document.getElementById("drug-list");
  var symptom_select = document.getElementById("symptom-select");
  var symptom = symptom_select.options[symptom_select.selectedIndex];
  /*
go through side effects,
if the symptom matches,
and the drug is in the drug-list,
then output the drug
  */
  side_effects.forEach(function(item,index) {
    var sideEffectDrugId = item[1];
    var sideEffectSymptomId = item[2];
    if (symptom.value == sideEffectSymptomId) {
      var i;
      for(i=0; i<drug_list.length; i++) {
        var drugId = drug_list.options[i].value;
        if (drugId == sideEffectDrugId) {
          console.log('matched ' + symptom.value.toString() + " with " + drug_list.options[i].text );
        }
      }
    }
  });
}

</script>
