<%= form_with(model: @sevs, local: true,
    :html => { :onsubmit => 'formsubmit();' } ) do |f| %>

<br>

<h4 style="text-align: center;">
  This text explains what's going on below
</h4>
<table border style="text-align: center; width:100%">
  <tr>
    <td>Choose Symptoms from the drop-down below and add them to the list
    </td>
    <td>Choose Meds from the drop-down below and add them to the list
    </td>
  </tr>

<!-- ------------------------------------------------- -->

<script>
  function loadDrugListOptions() {
    var list = document.getElementById('drugList');
    if (typeof(Storage) !== "undefined") {
      var list = document.getElementById('drugList');
      list.innerHTML = window.localStorage.getItem("drugList");
    }
  }
  function formsubmit() {
    drug_list_select_all();
  }
  function drug_list_options_change() {
    if (typeof(Storage) !== "undefined") {
      var list = document.getElementById('drugList');
      window.localStorage.setItem("drugList", list.innerHTML);
    }
  }
  function drug_list_add(selectedItem) {
    var option = document.createElement("option");
    option.id = selectedItem.value; // setting ID so we can use namedItem
    option.value = selectedItem.value;
    option.text = selectedItem.text;

    var list = document.getElementById('drugList');
    if (list.namedItem(option.value) == null) {
      list.add(option);
    }
    drug_list_options_change();
  }
  function drug_list_remove(selectedIndex) {
    document.getElementById("drugList").remove(selectedIndex);
    drug_list_options_change();
  }
  function drug_list_select_all() {
    var list = document.getElementById('drugList');
    for(var i=0; i<list.options.length; i++) {
      list.options[i].selected = true;
    }
  }
</script>

  <tr>
    <td>
      <%= select "symptom", "id", Symptom.all.collect {|p| [ p.name, p.id ] } %>
    </td>
    <td>
      <%= select_tag "drug-select",
          options_from_collection_for_select(Drug.all, "id", "name") %>
      <%= button_tag 'Add drug to list',
          type: 'button',
          :onclick => 'drug_list_add( document.getElementById("drug-select").options[document.getElementById("drug-select").selectedIndex] )' %>
    </td>
  </tr>
  <tr>
    <td>
      <!-- under symptom here .. ignore -->
    </td>
    <td>
      <%= select_tag "drugList", "",
          :size => 5, :style => "width: 150px;", multiple: true,
          :ondblclick => 'drug_list_remove(document.getElementById("drugList").selectedIndex)' %>
    </td>
  </tr>
</table>

<div style="text-align: center">
    <%= f.submit "Generate Report", :autofocus => true %>
</div>

<% end %>

<%= javascript_tag 'loadDrugListOptions()' %>
